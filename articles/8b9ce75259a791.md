---
title: "MUI + React Hook Form + Zod ã§ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ"
emoji: "ğŸ¡"
type: "tech"
topics:
  - "typescript"
  - "vite"
  - "reacthookform"
  - "zod"
  - "mui"
published: true
published_at: "2024-02-17 22:08"
---

# ã¯ã˜ã‚ã«
ä»Šå›ä½œã‚‹MUI + React Hook Form + Zodã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯â†“ã“ã¡ã‚‰ã§ã™ã€‚
https://github.com/49takaya3989/sample_react_mui_react-hook-form/tree/main/src/MUI%2BRHF_with_controller_and_zod

# é–‹ç™ºç’°å¢ƒ
```json
"vite": "^5.1.0"
"react": "18.2.0"
"typescript": "5.2.2"
"react-hook-form": "7.49.2"
"@mui/material": "5.15.0"
"@mui/x-date-pickers": "6.18.6"
```

# Zodã¨ã¯
> TypeScript ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®ã‚¹ã‚­ãƒ¼ãƒå®£è¨€ãŠã‚ˆã³æ¤œè¨¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ç§ã¯ã€å˜ç´”ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰è¤‡é›‘ãªãƒã‚¹ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ã§ã€ã‚ã‚‰ã‚†ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã‚’åºƒãæŒ‡ã™ãŸã‚ã«ã€Œã‚¹ã‚­ãƒ¼ãƒã€ã¨ã„ã†ç”¨èªã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™

https://zod.dev/

# ãªãœReact Hook Formã¨Zodã‚’çµ„ã¿åˆã‚ã›ã‚‹ã®ã‹ï¼Ÿ
React Hook Formã«ã‚‚[validate api](https://react-hook-form.com/docs/useform/register#:~:text=%7D%20/%3E-,Options,-By%20selecting%20the)ãŒå­˜åœ¨ã—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ãã“ã¨ã¯å¯èƒ½ã ãŒã€ä»–ã®ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå´ã«æ›¸ãå¿…è¦ãŒå‡ºã¦ãã¦ã€ã‚³ãƒ¼ãƒ‰ã®åˆ†é›¢ãŒé›£ã—ããªã‚‹ã€‚
ã¤ã¾ã‚Šã€ãƒ­ã‚¸ãƒƒã‚¯ã®ä½¿ã„å›ã—ãŒã§ããªã‹ã£ãŸã‚Šãƒ†ã‚¹ãƒˆã‚‚æ›¸ãã«ãããªã£ãŸã‚Šã™ã‚‹ã€‚ãã®ãŸã‚zodã®ã‚ˆã†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨ã„ã¦ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢ã‚’è¡Œã†ã€‚

# MUI ã¨ React Hook Form ã¨ Zod ã§ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆã™ã‚‹
1. Zodã§ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©
2. ãƒ•ã‚©ãƒ¼ãƒ ã®å‹å®šç¾©
3. defaultValueã‚’ä½œæˆã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹
4. RHFã«Zodã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨
5. å„ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
6. æ‰‹é †5 ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ

â€»RHFï¼šReact Hook Formã®ã“ã¨
## Zodã§ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©
```ts
const schema = z.object({
  nullAbleText: z.string(),
  text: z.string().min(1, {message: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'}),
  // TextField ã® value ãŒ string æ‰±ã„ãªãŸã‚ã€string ã¨ã—ã¦å®šç¾©
  nullAbleNumber: z.string(),
  number: z.string().refine(val => val !== '', {message: "æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"}).refine(val => Number(val) >= 0, {message: "æœ‰åŠ¹ãªæ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"}),
  nullAbleSelect: z.string(),
  select: z.string().min(1, {message: 'é¸æŠã—ã¦ãã ã•ã„ã€‚'}),
  nullAbleCheckboxes: z.array(z.string()),
  checkboxes: z.array(z.string()).refine(vals => vals.length > 0, {message: 'å°‘ãªãã¨ã‚‚1ã¤ã¯é¸æŠã—ã¦ãã ã•ã„'}),
  nullAbleCheckbox: z.boolean(),
  checkbox: z.boolean().refine(val => val === true, { message: "ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚"}),
  nullAbleRadio: z.string(),
  radio: z.string().min(1, {message: 'ä»»æ„ã®é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'}),
  nullAbleDate: z.string(),
  date: z.string().min(1, {message: 'æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'}).refine(val => new Date(val) > new Date(), {message: "æœ‰åŠ¹ãªæ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"}),
  nullAbleTextarea: z.string(),
  textarea: z.string().min(1, {message: 'ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'}),
});
```
â€»nullã‚’è¨±å®¹ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«ã¯nullAbleã‚’å…ˆé ­ã«ä»˜ã‘ã¦ã„ã‚‹ã€‚
## ãƒ•ã‚©ãƒ¼ãƒ ã®å‹å®šç¾©
Zodã«ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰å‹ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹`infer`ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’ä½¿ã„å‹ç”Ÿæˆã‚’è¡Œã†ã€‚
```ts
type Schema = z.infer<typeof schema>;
```
## defaultValueã‚’ä½œæˆã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹
Zodã®`.default()`ã§ã‚‚ defaultValue ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã ãŒã€ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€RHFã®defaultValueã§å®šç¾©ã™ã‚‹ã€‚
ã¾ãŸã€useFormã§keyã‚’ç›´æ›¸ãã—ã¦æŒ‡å®šã™ã‚‹kã¨ã¯å¯èƒ½ã ãŒã€Zodã®ã‚¹ã‚­ãƒ¼ãƒã¨äºŒé‡ç®¡ç†ã«ãªã‚‹ãŸã‚ã€ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰defaultValueã‚’ç”Ÿæˆã—ã€æŒ‡å®šã™ã‚‹ã€‚
ä¸€æ—¦ã€Zodã®ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰defaultValueã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚
```ts
const initFormVal = <T extends z.ZodRawShape>(schema: ZodObject<T>) => {
  return Object.entries(schema.shape).reduce<Record<string, unknown>>((acc, [key, val]) => {
    if (val instanceof z.ZodString) {
      acc[key] = ""
    } else if (val instanceof z.ZodNumber) {
      acc[key] = null
    } else if (val instanceof z.ZodBoolean) {
      acc[key] = false
    } else if (val instanceof z.ZodArray) {
      acc[key] = []
    } else if (val instanceof z.ZodEffects) {
      if (
        val._def.schema instanceof z.ZodString ||
        val._def.schema._def.schema instanceof z.ZodString
      ) {
        acc[key] = ""
      } else if (val._def.schema instanceof z.ZodArray) {
        acc[key] = []
      } else if (val._def.schema instanceof z.ZodBoolean) {
        acc[key] = false
      }
    } else {
      acc[key] = undefined
    }

    return acc
  }, {});
};
```
ä»Šå›ã¯ã€1ã¤ã®ã‚¹ã‚­ãƒ¼ãƒã—ã‹ä½œæˆã—ã¦ãªã„ã§ã™ãŒã€ã‚¹ã‚±ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã€å¼•æ•°ã«ã‚¹ã‚­ãƒ¼ãƒã‚’å–ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
## RHFã«Zodã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨
ä¸Šè¨˜ã§ä½œæˆã—ãŸé–¢æ•°ã‚’ã‚‚ã¨ã«ã€defaultValueã‚’æŒ‡å®šã™ã‚‹ã€‚
```ts
const { ... } = useForm<Schema>({
    resolver: zodResolver(schema),
    defaultValues: initFormVal(schema)
  })
```
## å„ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
ãã‚Œãã‚Œã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
:::details ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å…±é€šãƒ©ãƒƒãƒ‘ãƒ¼
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/FormItemWrapper.tsx
:::
:::details ãƒ†ã‚­ã‚¹ãƒˆ, æ•°å€¤
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfTextField.tsx```
:::details ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfSelect.tsx
:::
:::details å˜ä½“ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfOneCheckbox.tsx
:::
:::details è¤‡æ•°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfMultiCheckbox.tsx
:::
:::details ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfRadio.tsx
:::
:::details æ—¥ç¨‹
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfDatePicker.tsx
:::
:::details ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/RhfTextarea.tsx
:::

## æ‰‹é †5 ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
```tsx
import {
  Box,
  Button,
  Container,
  Stack,
} from "@mui/material"
import {
  SubmitHandler,
  useForm,
} from "react-hook-form"
import { zodResolver } from '@hookform/resolvers/zod'
import { schema, type Schema } from './schema';
import RhfTextarea from './RhfTextarea';
import RhfSelect, { SelectOptions } from './RhfSelect';
import { initFormVal } from './utils';
import RhfMultiCheckbox, { MultiCheckboxOptions } from './RhfMultiCheckbox';
import RhfOneCheckbox from './RhfOneCheckbox';
import RhfTextField from './RhfTextField';
import RhfRadio, { RadioOptions } from './RhfRadio';
import RhfDatePicker from './RhfDatePicker';

const selectOptions: SelectOptions[] = [
  { label: "0", value: "0" },
  { label: "1", value: "1" },
  { label: "2", value: "2" },
  { label: "3", value: "3" },
  { label: "4", value: "4" },
  { label: "5", value: "5" },
] as const;

const checkboxesOptions: MultiCheckboxOptions[] = [
  { label: "é¸æŠè‚¢1", value: "sentakushi1" },
  { label: "é¸æŠè‚¢2", value: "sentakushi2" },
  { label: "é¸æŠè‚¢3", value: "sentakushi3" },
] as const;

const radioOptions: RadioOptions[] = [
  { label: "ãƒ©ã‚¸ã‚ª1", value: "radio1" },
  { label: "ãƒ©ã‚¸ã‚ª2", value: "radio2" },
  { label: "ãƒ©ã‚¸ã‚ª3", value: "radio3" },
] as const;

function MuiRhfWithControllerAndZod() {
  const {
    handleSubmit,
    control,
  } = useForm<Schema>({
    mode: 'onSubmit', // åˆå›validationæ™‚ã‚’æ¤œç´¢ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«è¨­å®š
    reValidateMode: 'onBlur', // é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«å¼•ã£ã‹ã‹ã£ãŸå¾Œã¯ã€å¸¸ã«å…¥åŠ›å€¤ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸéš›ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ°ã‚‹
    resolver: zodResolver(schema), // å¤–éƒ¨ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹
    defaultValues: initFormVal(schema)
  })

  const onSubmit: SubmitHandler<Schema> =
    (data) => console.log('data', data)

  return (
    <Container maxWidth="sm" sx={{ pt: 5 }}>
      <Box component="form" onSubmit={handleSubmit(onSubmit)} sx={{ mt: 1 }}>
        <Stack spacing={3}>
          {/* ãƒ†ã‚­ã‚¹ãƒˆ */}
          <RhfTextField
            type='text'
            name="nullAbleText"
            label='ãƒ†ã‚­ã‚¹ãƒˆ'
            control={control}
            />
          <RhfTextField
            type='text'
            name="text"
            label='ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå¿…é ˆï¼‰'
            control={control}
            />

          {/* æ•°å€¤ */}
          <RhfTextField
            name="nullAbleNumber"
            type='number'
            label='æ•°å€¤'
            control={control}
            />
          <RhfTextField
            name="number"
            type='number'
            label='æ•°å€¤ï¼ˆå¿…é ˆï¼‰'
            control={control}
            />

          {/* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ */}
          <RhfSelect
            name="nullAbleSelect"
            control={control}
            label="ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹"
            options={selectOptions}
            />
          <RhfSelect
            name="select"
            control={control}
            label="ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼ˆå¿…é ˆï¼‰"
            options={selectOptions}
            />

          {/* å˜ä½“ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */}
          <RhfOneCheckbox
            label="ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹"
            name="nullAbleCheckbox"
            control={control}
            />
          <RhfOneCheckbox
            label="ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆå¿…é ˆï¼‰"
            name="checkbox"
            control={control}
            />

          {/* è¤‡æ•°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */}
          <RhfMultiCheckbox
            label="è¤‡æ•°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹"
            name="nullAbleCheckboxes"
            control={control}
            options={checkboxesOptions}
            />
          <RhfMultiCheckbox
            label="è¤‡æ•°ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆå¿…é ˆï¼‰"
            name="checkboxes"
            control={control}
            options={checkboxesOptions}
            />

          {/* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ */}
          <RhfRadio
            label="ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³"
            name="nullAbleRadio"
            control={control}
            options={radioOptions}
            />
          <RhfRadio
            label="ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼ˆå¿…é ˆï¼‰"
            name="radio"
            control={control}
            options={radioOptions}
            />

          {/* æ—¥ç¨‹ */}
          <RhfDatePicker
            name="nullAbleDate"
            label='æ—¥ç¨‹'
            control={control}
            />
          <RhfDatePicker
            name="date"
            label='æ—¥ç¨‹ï¼ˆå¿…é ˆï¼‰'
            control={control}
            />

          {/* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */}
          <RhfTextarea
            name="nullAbleTextarea"
            label='ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢'
            control={control}
            rows={5}
            />
          <RhfTextarea
            name="textarea"
            label='ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ï¼ˆå¿…é ˆï¼‰'
            control={control}
            rows={5}
            />
          <Button
            type="submit"
            color="primary"
            variant="contained"
            size="large"
            >
            ãƒœã‚¿ãƒ³
          </Button>
        </Stack>
      </Box>
    </Container>
  )
}

export default MuiRhfWithControllerAndZod
```
### ãŠã¾ã‘
`useForm`ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ã—ã¦ã¾ã¨ã‚ã‚‹
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/useSampleForm.ts
https://github.com/49takaya3989/sample_react_mui_react-hook-form/blob/main/src/MUI%2BRHF_with_controller_and_zod/index.tsx
ä»¥ä¸Šï¼

å‚è€ƒè¨˜äº‹
https://tech.buysell-technologies.com/entry/adventcalendar2022-12-24
https://zenn.dev/monicle/articles/4868424f22d6f5