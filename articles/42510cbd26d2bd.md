---
title: "React + Reduxã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼ã‚’Sentryã§ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹"
emoji: "ğŸ˜º"
type: "tech"
topics:
  - "react"
  - "redux"
  - "sentry"
published: true
published_at: "2024-02-10 16:36"
---

# ã¯ã˜ã‚ã«
ä»Šå›ç´¹ä»‹ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®å®Œæˆå½¢ã¯ã“ã¡ã‚‰â†“
https://github.com/49takaya3989/sample-react-redux-sentry

# é–‹ç™ºç’°å¢ƒ
@reduxjs/toolkit: ^2.1.0
@sentry/react: ^7.100.1
react: ^18.2.0
react-dom: ^18.2.0
react-redux: ^9.1.0

# Sentryã¨ã¯
> Sentry ã¯ã€é–‹ç™ºè€…ãŒã‚³ãƒ¼ãƒ‰é–¢é€£ã®å•é¡Œã‚’ç‰¹å®šã—ã¦ä¿®æ­£ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ç›£è¦–ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ Sentry ã¯ã€ã‚¨ãƒ©ãƒ¼è¿½è·¡ã‹ã‚‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¾ã§ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®å¯è¦³æ¸¬æ€§ã‚’æä¾›ã—ã€å•é¡Œã®è¨ºæ–­ã‚’å®¹æ˜“ã«ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚³ãƒ¼ãƒ‰ã®å¥å…¨æ€§ã«ã¤ã„ã¦ç¶™ç¶šçš„ã«å­¦ç¿’ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://docs.sentry.io/product/

# Sentryã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã™ã‚‹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
## ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã™ã‚‹
[å…¬å¼docs](https://sentry.io/welcome/)ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’ã™ã‚‹
## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
Create Projectã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã‚’è¡Œã†ã€‚
æœ€åˆã«è¨€èªãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é¸æŠã™ã‚‹ç”»é¢ã§Reactã‚’é¸æŠã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2a4523ec5af2-20240210.png)
`Set your alert frequency`ã¨`Name your project and assign it a team`ã¯ä»»æ„ã®ã‚‚ã®ã‚’é¸æŠã™ã‚‹ã€‚

ä»Šå›ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®šã€‚
![](https://storage.googleapis.com/zenn-user-upload/c4020ab4624f-20240210.png)


# Reactã®ç’°å¢ƒé–‹ç™ºã‚’æ§‹ç¯‰
â†“ã“ã¡ã‚‰ã‚’å‚ç…§
https://zenn.dev/takaya39/articles/207e3e393081d9

# reduxã§storeã‚’æ§‹ç¯‰
https://github.com/reduxjs/redux

1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒˆãƒ¼ãƒ«
2. store ã‚’ä½œæˆã™ã‚‹
3. redux ã‚’ reactã€€ã«ç¹‹ã’ã‚‹
4. UI ã§ store ã®å€¤ã‚’å‘¼ã³å‡ºã™
## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒˆãƒ¼ãƒ«
```
npm install @reduxjs/toolkit react-redux
```
## store ã‚’ä½œæˆã™ã‚‹
ä»Šå›ã¯ç°¡æ˜“çš„ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã®æ§‹æˆã«ã™ã‚‹ã€‚
::::details counterSlice.ts
```ts
import { createSlice, PayloadAction } from '@reduxjs/toolkit';

interface CounterState {
  value: number;
}

const initialState: CounterState = {
  value: 0,
};

export const counterSlice = createSlice({
  name: 'counter',
  initialState,
  reducers: {
    incremented: state => {
      state.value += 1;
    },
    decremented: state => {
      state.value -= 1;
    },
    incrementedByAmount: (state, action: PayloadAction<number>) => {
      state.value += action.payload;
    },
  },
});

export const { incremented, decremented, incrementedByAmount } = counterSlice.actions;
export default counterSlice.reducer;
```
::::
::::details store.ts
```ts
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from '../features/counter/counterSlice'

export const store = configureStore({
  reducer: {
    counter: counterReducer
  }
})

// RootStateå‹ã®å®šç¾©
export type RootState = ReturnType<typeof store.getState>;

// AppDispatchå‹ã®å®šç¾©
export type AppDispatch = typeof store.dispatch;
```
::::

## redux ã‚’ react ã«ç¹‹ã’ã‚‹
ä¸‹è¨˜ã®ã‚ˆã†ã«`<Provider>`ã§å›²ã‚“ã§ã‚ã’ã‚‹ã ã‘ã§å®Œäº†
```diff tsx
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
-    <App />
+    <Provider store={store}>
+      <App />
+    </Provider>
  </React.StrictMode>,
)
```
## UI ã§ store ã®å€¤ã‚’å‘¼ã³å‡ºã™
ä»Šå›ã€`useSelector`ã‚„`useDispatch`ã®èª¬æ˜ã€ãŠã‚ˆã³ä½¿ã„æ–¹ã®æ­£ã—ã•ãªã©ã«é–¢ã—ã¦ã¯çœç•¥ã—ã¾ã™ã€‚
```tsx:App.tsx
import React from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { RootState } from './store';
import { decremented, incremented, incrementedByAmount } from './counterSlice';

const App: React.FC = () => {
  // Reduxã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å€¤ã‚’å–å¾—
  const counterValue = useSelector((st: RootState) => st.counter.value);
  const dispatch = useDispatch();

  return (
    <div>
      <h2>Counter</h2>
      <div>
        <button className='btn' onClick={() => dispatch(decremented())}>-</button>
        <span className='num'>{counterValue}</span>
        <button className='btn' onClick={() => dispatch(incremented())}>+</button>
      </div>
      <div>
        <button onClick={() => dispatch(incrementedByAmount(5))}>+5</button>
      </div>
    </div>
  );
};

export default App;
```
ä¸‹è¨˜ç”»åƒã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°ã€ç¢ºèªå®Œäº†ï¼
â€»ã‚¹ã‚¿ã‚¤ãƒ«ã¯è¦‹ã‚„ã™ã„ã‚ˆã†ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰å°‘ã—ã„ã˜ã£ã¦ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/8ef77c783b91-20240210.png)

# Sentryã®SDKãªã©ã‚’å®Ÿè£…
1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. SDKã®è¨­ç½®
3. ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã™ã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™
4. redux ã®æƒ…å ±ã‚’é€ã‚‹ãŸã‚ã®è¨­å®š
## å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```
npm install --save @sentry/react
```

## SDKã®è¨­ç½®
Sentryã®Configè¨­å®šã¯ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ãªã‚‹ã¹ãæ—©ã„æ®µéšã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€`src/main.tsx`ã«è¨˜è¼‰ã™ã‚‹ã€‚
å„é …ç›®ã®è©³ã—ã„èª¬æ˜ã«é–¢ã—ã¦ã¯ã€[å…¬å¼docs](https://docs.sentry.io/platforms/javascript/guides/react/)ã‚’ç¢ºèªã€‚
```tsx:main.tsx
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import { Provider } from 'react-redux'
import { store } from './store.ts'
import './index.css'
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: <your_dns>,
  integrations: [
    Sentry.browserTracingIntegration(),
    Sentry.replayIntegration({
      maskAllText: false, // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚¹ã‚¯ã™ã‚‹ã‹ã©ã†ã‹
      blockAllMedia: false, // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®ç†ç”±ã‹ã‚‰ãƒ¡ãƒ‡ã‚£ã‚¢ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã‹ã©ã†ã‹
    }),
  ],

  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
  tracesSampleRate: 1.0, // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ç™ºç”Ÿã™ã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã†ã¡ã€ã©ã‚Œã ã‘ã®å‰²åˆã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã™ã‚‹å‰²åˆ

  // 'tracePropagationTargets'ã§ã€åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹URL
  tracePropagationTargets: ["localhost", /^https:\/\/yourserver\.io\/api/], // åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã‚’é©ç”¨ã™ã‚‹URLãƒ‘ã‚¿ãƒ¼ãƒ³

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒªãƒ—ãƒ¬ã‚¤
  replaysSessionSampleRate: 0.1, // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒªãƒ—ãƒ¬ã‚¤ã‚’è¡Œã†ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å‰²åˆ
  replaysOnErrorSampleRate: 1.0, // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒªãƒ—ãƒ¬ã‚¤ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®š
});

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>,
)

```
## ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã™ã‚³ãƒ¼ãƒ‰ã‚’æº–å‚™
è¨­å®šãŒæ­£å¸¸ã«ã§ãã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãè½ã¨ã™ãƒ€ãƒŸãƒ¼ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã€‚
```diff tsx:App.tsx
import React from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { RootState } from './store';
import { decremented, incremented, incrementedByAmount } from './counterSlice';

const App: React.FC = () => {
  ...

  return (
    <div>
      <h2>Counter</h2>
      <div>
        <button className='btn' onClick={() => dispatch(decremented())}>-</button>
        <span className='num'>{counterValue}</span>
        <button className='btn' onClick={() => dispatch(incremented())}>+</button>
      </div>
      <div>
        <button onClick={() => dispatch(incrementedByAmount(5))}>+5</button>
      </div>

+      <button onClick={() => methodDoesNotExist()}>Break the world</button>
    </div>
  );
};

export default App;
```
è¿½åŠ ã—ãŸã€`Break the world`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ä¸‹è¨˜ç”»åƒã®ã‚ˆã†ã«ã€sentryã«ã‚¨ãƒ©ãƒ¼ãŒé€šçŸ¥ã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã€‚
â€»é€šä¿¡ç’°å¢ƒãªã©ã«ã‚ˆã£ã¦ã¯ã€sentryã¸ã®ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã«æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚‹
![](https://storage.googleapis.com/zenn-user-upload/d8403246d75c-20240210.png)

## redux ã®æƒ…å ±ã‚’é€ã‚‹ãŸã‚ã®è¨­å®š
ä¸Šè¨˜ã¾ã§ã®è¨­å®šã ã¨ã€`action type`ã‚„`store`ã®æƒ…å ±ã‚’sentryã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚
ã‚¨ãƒ©ãƒ¼å†ç¾ã«å½¹ç«‹ã¡ãã†ãª`action type`ã‚„`store`ã‚’ã€sentryã§ã‚‚ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã€[ã“ã¡ã‚‰](https://zenn.dev/takaya39/articles/42510cbd26d2bd#store-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B)ã§ä½œæˆã—ãŸ store ã«ä¿®æ­£ã‚’åŠ ãˆã‚‹ã€‚
```ts:store.ts
import { Action, AnyAction, configureStore } from '@reduxjs/toolkit';
import counterReducer from './counterSlice';
import { createReduxEnhancer } from '@sentry/react';

type StateType = ReturnType<typeof counterReducer>;

// sentryã¸é€ä¿¡ã™ã‚‹ action ã¨ state ã‚’å®šç¾©
const sentryReduxEnhancer = createReduxEnhancer({
  actionTransformer: (action: Action | AnyAction) => action,
  stateTransformer: (state: StateType) => state,
});

export const store = configureStore({
  ...
  enhancers: (getDefaultEnhancers) => getDefaultEnhancers().concat(sentryReduxEnhancer),
});

...
```
å†åº¦ã€`Break the world`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ç”»é¢ã®`breadcrumbs`ã«redux.actionãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚Œã°æˆåŠŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/6b2e9b75a427-20240210.png)

ä»¥ä¸Šï¼