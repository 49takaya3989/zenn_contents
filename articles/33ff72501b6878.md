---
title: "GitHub Actions ã¨ Husky ã§ Vitest ã‚’å‹•ã‹ã™"
emoji: "ğŸ£"
type: "tech"
topics:
  - "githubactions"
  - "husky"
  - "lintstaged"
  - "vitest"
published: true
published_at: "2024-03-23 02:01"
---

# é–‹ç™ºç’°å¢ƒ
# Github Actions ã‚„ Husky(lint-staged)ã€ Vitest ã®èª¬æ˜
Github Actions ã‚„ Husky(lint-stage)ã€ Vitest ã®ä½¿ã„æ–¹ã‚„0ã‹ã‚‰ã®æ§‹ç¯‰ã«é–¢ã—ã¦ã¯ä¸‹è¨˜è¨˜äº‹ã§èª¬æ˜ã‚’ã—ã¦ã„ã‚‹ã®ã§ã‚ˆã‘ã‚Œã°å‚è€ƒã«ã€‚
https://zenn.dev/takaya39/articles/8f6b58cc6124d4
https://zenn.dev/takaya39/articles/2289ffb0d6800f
https://zenn.dev/takaya39/articles/aa7081b65e9a13
# å°å…¥
1. Husky(lint-staged) ã« Vitest ç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹
2. vitest ç”¨ã® workflow ã‚’ä½œæˆã™ã‚‹
## Husky(lint-staged) ã« Vitest ç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹
Husky(lint-staged) ã¯æ§‹ç¯‰æ¸ˆã¿ã®å‰æã§é€²ã‚ã‚‹ã€‚
package.json ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ lint-staged ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ä¸‹è¨˜ã‚’è¿½åŠ ã™ã‚‹ã€‚
```json
"lint-staged": {
  ãƒ»ãƒ»ãƒ»
  "*.test.{ts?(x)}": [
    "vitest run --coverage"
  ]
},
```
## vitest ç”¨ã® workflow ã‚’ä½œæˆã™ã‚‹
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«`.github/workflows/test.yml`ã‚’ä½œæˆã—ã€ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã€‚
```yml
# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å
name: Test codes
# ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æŒ‡å®š
on:
  pull_request:
    types: [opened, reopened, synchronize]
jobs:
  Test:
    name: Run test codes
    if: |
      github.event.pull_request.draft == false
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install packages
        run: npm ci

      - name: Show coverage
        run: npm run test:coverage
```
ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã–ã£ã¨èª¬æ˜ã€‚
`name: Test codes`
PRã‚’ä½œæˆã—ãŸéš›ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã€‚
![](https://storage.googleapis.com/zenn-user-upload/afe848d5d6a0-20240316.png)

`pull_request: types: [opened, reopened, synchronize]`
github actions ãŒç™ºç«ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚

`if: github.event.pull_request.draft == false`
PR ãŒ Open ã®æ™‚ã®ã¿ç™ºç«ã™ã‚‹ã€‚

`runs-on: ubuntu-latest`
github actions ã®å®Ÿè¡Œç’°å¢ƒã€‚

`uses: actions/checkout@v4`
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã€‚

`run: npm ci`
`run: npm run test:coverage`
package.json ã§è¨­å®šã—ãŸãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€‚

## å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹
ä»»æ„ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã€push ã—ã¦ PR ã‚’ä½œæˆã™ã‚‹ã€‚ä½œæˆã—ãŸ PR ã®ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã€`Test codes / Run test codes (pull_request)`ã«âœ…ãŒã¤ã„ã¦ã„ã‚Œã°æˆåŠŸï¼
å®Ÿéš›ã«ã©ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ãŒå‹•ã„ã¦ã„ã‚‹ã®ã‹ãŒæ°—ã«ãªã‚‹æ–¹ã¯ã€`Test codes / Run test codes (pull_request)`ã®å³å´ã«ã‚ã‚‹`Details`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€ä¸‹è¨˜æ·»ä»˜ãŒãã†ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã‚Œãã‚Œã®ãƒˆã‚°ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã„ã¦ã¿ã¦ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0c7f7565f0b7-20240316.png)

:::message
Github Actions ã§ ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã™ã¨ã€ç„¡é§„ã«ã‚³ã‚¹ãƒˆãŒã‹ã‹ã£ã¦ã—ã¾ã†ã®ã§ã€ã‚ã‚‰ã‹ãŸã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¯ Husky ãªã©ã®ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã—ã¦ã€é‡è¦ãªãƒ†ã‚¹ãƒˆã®ã¿ Github Actions ã§å®Ÿè¡Œã™ã‚‹ã®ãŒè‰¯ã•ãã†ã€‚
:::

ä»¥ä¸Šï¼