---
title: "lint-staged ã§ commit ã‚’åˆ¶å¾¡ã™ã‚‹"
emoji: "ğŸ’¬"
type: "tech"
topics:
  - "husky"
  - "precommit"
  - "lintstaged"
published: true
published_at: "2024-03-09 22:52"
---

# ã¯ã˜ã‚ã«
ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰â†“
https://github.com/49takaya3989/sample_lint-staged

# é–‹ç™ºç’°å¢ƒ
```json
"@commitlint/cli": "^19.0.3",
"@commitlint/config-conventional": "^19.0.3",
"husky": "^9.0.11",
"lint-staged": "^15.2.2",
```
# lint-staged ã¨ã¯ï¼Ÿ
> ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚ŒãŸ git ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ãƒªãƒ³ã‚¿ãƒ¼ã‚’å®Ÿè¡Œã—ã€ğŸ’© ãŒã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ç´›ã‚Œè¾¼ã¾ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

https://github.com/lint-staged/lint-staged

# åˆæœŸç’°å¢ƒæ§‹ç¯‰
â†“ã“ã¡ã‚‰ã®è¨˜äº‹ã§ Vite + React ã®ç’°å¢ƒæ§‹ç¯‰ã‚’è§£èª¬ã—ã¦ã„ã‚‹ã®ã§ã‚ˆã‘ã‚Œã°å‚è€ƒã«ã€‚
https://zenn.dev/takaya39/articles/207e3e393081d9

# commitã®åˆ¶å¾¡
lint-staged ã® [readme](https://github.com/lint-staged/lint-staged) ã‚’å‚è€ƒã«é€²ã‚ã¦ã„ãã€‚
1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ

## å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```node
npm install --save-dev lint-staged @commitlint/{cli,config-conventional} husky
```
commitlint, huskyï¼šã‚³ãƒŸãƒƒãƒˆã‚’åˆ¶å¾¡ã™ã‚‹ã®ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
`package.json`ã« lint-staged ã®è¨­å®šã‚’è¿½åŠ ã™ã‚‹ã€‚
ä»Šå›ã¯ã‚³ãƒŸãƒƒãƒˆæ™‚ã« .ts ã¨ .tsx ã®ã‚³ãƒ¼ãƒ‰ã«å¯¾ã—ã¦ lint ã¨ prettier ã‚’èµ°ã‚‰ã›ã‚‹ãŸã‚ã®è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚
```diff json:package.json
{
  ãƒ»ãƒ»ãƒ»
  "lint-staged": {
    "*.{ts,tsx}": [
      "prettier --write",
      "eslint ."
    ]
  },
}
```
â€» `eslint .`ã¯`eslint --fix`ã§ã‚‚ã„ã„ãŒã€å€‹äººçš„ã«å‹æ‰‹ã« fix ã—ã¦ã»ã—ããªã„ã®ã§`eslint .`ã¨ã—ã¦ã„ã‚‹ã€‚

commitlint ã¨ husky ã®è¨­å®šã‚’è¡Œã†ã€‚
```node
echo "export default { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
npx husky init
echo "npx --no -- commitlint --edit \$1" > .husky/commit-msg
```

`npx husky init`ã§ç”Ÿæˆã•ã‚ŒãŸ`.husky/pre-commit`ã‚’ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã«æ›¸ãæ›ãˆã‚‹ã€‚
```
#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```
è¨­å®šã¯ã“ã“ã¾ã§ã€‚
## ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ
ã‚³ãƒ¼ãƒ‰ãŒæ­£å¸¸ã«å‹•ãã‹ã®ç¢ºèªã‚’è¡Œã†ã€‚
ã¾ãšã¯ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‹ã®ç¢ºèªã‚’è¡Œã†ãŸã‚ã«ã€ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```
git add .
git commit -m "test"
```
ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚Œã°æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã€‚
```
âœ” Preparing lint-staged...
âœ” Running tasks for staged files...
âœ” Applying modifications from tasks...
âœ” Cleaning up temporary files...
â§—   input: test
âœ–   subject may not be empty [subject-empty]
âœ–   type may not be empty [type-empty]

âœ–   found 2 problems, 0 warnings
â“˜   Get help: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

husky - commit-msg script failed (code 1)
```
æ¬¡ã«ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
```
git commit -m "feat: test"
```
ã‚³ãƒŸãƒƒãƒˆãŒæˆåŠŸã™ã‚Œã°ã€æ­£å¸¸ã«å‹•ã„ã¦ã„ã‚‹ã€‚

### prettier --write failed without output (ENOENT).ãŒå‡ºã‚‹å ´åˆ
`prettier --write failed without output (ENOENT).`ãŒå‡ºã‚‹å ´åˆã¯ã€ [prettier](https://prettier.io/docs/en/install) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã¨ã„ã†ã“ã¨ãªã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
â†“ä¸‹è¨˜è¨˜äº‹ã§prettierã®å°å…¥ã«é–¢ã—ã¦è§£èª¬ã—ã¦ã„ã‚‹ã®ã§å‚è€ƒã¾ã§ã«ã€‚
https://zenn.dev/takaya39/articles/0a8a9fae99001f
ä»¥ä¸Šï¼